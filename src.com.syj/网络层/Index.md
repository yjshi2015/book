# 网络层

## 跳数限制(hop limit)
   是为了防止数据报在网络中无限期的存在，消耗网络带宽资源而设置的一个限制。源点在每个数据报发出时即设定某个跳数限制(最大为255跳)。每个
   路由器在转发数据报时，都要先把跳数限制字段中的值减1。当跳数限制的值为0时，就要把这个数据报丢弃。
   
## TRACEROUTE:跟踪一个分组从源点到终点的路径 
   `tracert`:从源主机向目的主机发送一连串的IP数据报，数据报中封装的是无法交付的UDP用户数据报。第一个数据报P1的生存时间TTL设置为1。
   当P1达到路径上第一个路由器R1时，路由器R1先收下它，接着把TTL的值减1,。由于TTL等于0了，R1就把P1丢弃了，并向源主机发送一个**ICMP时间
   超过**差错报告报文。
   源主机接着发送第二个数据报P2，并把TTL设置为2。P2先到达路由器R1，R1收下后把TTL减1再转发给路由器R2。R2收到P2时TTL为1，但减1后TTL为
   0。R2就丢弃P2，并向源主机发送一个**ICMP时间超过**差错报文报告。这样一直下去。当最后一个数据报到达目的主机时，数据报的TTL是1。主机
   不转发数据报，也不把TTL减1。但因IP数据报中封装的是无法交付的传输层的UDP用户数据报，因此目的主机要向源主机发送**ICMP终点不可达**的
   差错报告报文。
   这样，源主机到达了自己的目的地，因为这些路由器和最后的目的主机发来的ICMP报文正好给出了源主机想知道的路由信息：**记录了到达目的主机
   所经过的路由器的IP地址，以及到达每一个路由器的往返时间**。注意：由于互联网的拥塞程度随时都在变化，因此，完全有这样的可能：经过更
   多地路由器反而花费更少的时间。

## IPV6
   解决IP地址耗尽的根本措施就是采用具有更大地址空间的新版本的IP，即IPv6。IPv6把地址从IPv4的32位增大到4倍，即增大到128位。
   由于现在整个互联网的规模太大，因此，“规定某个日期，从这一天起所有的路由器都改为IPv6”，显然是不可能的。这样，向IPv6过渡只能采用**逐步
   演进**的办法。同时，使新安装的IPv6系统能够向后兼容，这就是说，IPv6系统必须能够接收和转发IPv4分组，并且能够为IPv4分组选择路由。
   向IPv6过渡的策略可分如下两种：
   **双协议栈(dual stack)**：是指在完全过渡到IPv6之前，使一部分主机(或路由器)装有双协议栈：一个IPv4和一个IPv6。因此双协议栈主机(或
   路由器)即能够和IPv6的系统通信，又能够和IPv4的系统通信。双协议栈的主机(或路由器)即为IPv4/IPv6，表明表明它同时具有两种IP地址。
   例如：如果源主机和目的主机都是用IPv6，但中间有段路径为IPv4网络，则把IPv6的数据报首部转为IPv4的数据报首部进行发送，到达目的地侧的路
   由器后，再把IPv4的首部转为IPv6。需要注意的是：会导致IPv6中的某些字段无法恢复。这是不可避免的。
   类似于java的bean转化中的DTO转VO的场景
   **隧道技术(tunneling)**：这种方法的要点就是在IPv6数据报要进入IPv4网络时，把IPv6数据报封装成IPv4数据报。现在整个的IPv6数据报变成
   了IPv4数据报的数据部分。这样的IPv4数据报在IPv4网络中传输，就像在IPv4网络的隧道中传播，什么都没有发生变化。当IPv4数据报离开IPv4网络
   时，再把数据部分(即原来的IPv6数据报)交给主机的IPv6协议栈。
   类似于java传递数据时把bean放在Result的data中一样。

## 专用地址
   由于IP地址的紧缺，一个机构能申请到的IP地址数往往远小于本机构所拥有的主机数。考虑到互联网并不是很安全，并且，一个机构内
   也并不需要把所有的主机接入到外部的互联网。因此，机构内部使用的计算机就可以本机构**自行分配**其IP地址，分配的IP只要符合RFC 1918协议
   指明的**专用地址**(private address)即可。这些地址只能够用于机构的内部通信，而不能和互联网上的主机通信。并且，**互联网中的所有路由
   器，对目的地址是专用地址的数据报一律不进行转发**。
   专用地址：
   (1) 10.0.0.0到10.255.255.255
   (2) 172.16.0.0到172.32.255.255
   (3) 192.168.0.0到192.168.255.255
 
## 专用互联网
   采用以上的专用IP地址组成的网络成为专用网。全世界可能有很多的专用网具有相同的专用IP地址，但这并不会引起麻烦，因为这些专用地址仅在本机
   构内部使用。
 
## VPN
   有些很大的机构的许多部门分步的范围很广，例如在世界各地，这些部门经常要交互信息。可以利用**共用的互联网作为本机构专用网之间的通信
   载体**，这样的专用网称之为VPN(Virtual Private Network)。
   假定某个机构在两个相隔较远的地方建立了专用网A和B，现在这两个场所需要通过公用的互联网构成一个VPN。显然，**每一个场所至少要有一个路
   由器具有合法的全球IP地址**

## 网络地址转换NAT
   在专用网内部的一些主机本来已经分配到了本地IP地址，但现在又想和互联网上的主机通信，就需要用到**网络地址转换**(Network Address Tr-
   anslation)。这种方式需要在专用网连接到互联网的路由器上安装NAT软件。这样，所有使用**本地地址**的主机和外界通信时，都要在NAT路由器
   上将其本地地址转换成全球IP地址，才能和互联网连接。
   
## 网络地址与端口号转换(Network Address and Port Translation)
   为了更加有效的利用NAT路由器上的全球IP地址，现在常用的NAT转换表把传输层的端口号也利用上。这样，**就可以使多个拥有本地地址的主机，共
   用一个NAT路由器上的全球IP地址**,因而可以同时和互联网上的不同主机进行通信。
   类似于公司内部每个同事都可以在办公网联外网，但大家都用的一个全球IP，只不过在NAT上对应的端口号不同而已。